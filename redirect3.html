<script>
  async function main() {
    const statusEl = document.getElementById("status");

    // ★ リッチメニューと完全一致させる
    const LIFF_ID = "2008805355-pfJagaTF";

    const STRIPE_PAYMENT_LINK =
      "https://buy.stripe.com/8x23cw0cyeLNc2P708cQU05";

    try {
      statusEl.textContent = "LIFF初期化中...";
      await liff.init({ liffId: LIFF_ID });

      if (!liff.isLoggedIn()) {
        statusEl.textContent = "LINEログイン中...";
        liff.login();
        return;
      }

      statusEl.textContent = "プロフィール取得中...";
      const profile = await liff.getProfile();

      const url = new URL(STRIPE_PAYMENT_LINK);
      url.searchParams.set("client_reference_id", profile.userId);

      statusEl.textContent = "決済画面を開きます...";
      liff.openWindow({
        url: url.toString(),
        external: true
      });

    } catch (e) {
      console.error(e);
      statusEl.textContent = "エラー：\n" + (e?.message || e);
    }
  }

  main();
</script>
